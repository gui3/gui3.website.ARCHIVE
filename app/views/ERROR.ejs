<section class="white">
  <article class="textCenter">

    <h2>âš¡âš¡ OOOPS ... 500</h2>
    <p>
      On dirais que le serveur a connu une erreur ...
    </p>
    <p>
      <a href="/">
        â†ªï¸ tenter de retourner Ã  la page principale
      </a><br/>
      <em>
        parce qu'on sait jamais,
        sur un malentendu Ã§a peut marcher
      </em>
    </p>
    <p>
      <a onclick="askServer('reload')">
        ğŸ“œ essayer de recharger les scripts (admin)
      </a><br/>
      <em>
        l'application se relance elle mÃªme,
        ne recharge pas les node_modules
      </em>
    </p>
    <p>
      <a onclick="askServer('reboot')">
        ğŸ’½ essayer de rebooter le serveur (admin)
      </a><br/>
      <em>
        tue l'application !
        le serveur devrait Ãªtre relancÃ© par l'hÃ©bergeur
      </em>
    </p>
    <p>
      <a href="mailto:guillaume.silvent@hotmail.fr">
        ğŸ“§ j'ai tout essayÃ©, j'envoie un EMAIL au webmaster
      </a>
    </p>

  </article>
  <hr>
  <article class="">
    <h4>Stack de l'erreur :</h4>
    <pre>
      <code>
        <%= locals.err
          ? locals.err.stack
            ? locals.err.stack
            : locals.err.message
              ? locals.err.message
              : locals.err
          : 'erreur non tracee'
           %>
      </code>
    </pre>
  </article>
</section>

<script type="text/javascript">
const askServer = (function setupCooldown () {
  const coolDown = 5000
  let lastClick = Date.now() - coolDown

  function startCoolDown () {
    lastClick = Date.now()
  }
  function checkCoolDown () {
    const notOver = Date.now() - lastClick < coolDown
    if (notOver) alert('stop spamming the server !')
    return !notOver
  }

  return function askServer (code) {
    if (checkCoolDown()) {
      startCoolDown()

      const password = prompt('please give the PASSWORD')
      if (password) {
        var xhr = new XMLHttpRequest()
        xhr.open("POST", '/' + code, true)
        xhr.setRequestHeader(
          'Content-Type',
          'application/json'
        )
        xhr.send(JSON.stringify({
          pswd: password
        }));
        console.log(code + ' request send')
      }
    }
  }
})()

</script>
